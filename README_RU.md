# Chrome Lens API для Python

[English](/README.md) | [Русский](/README_RU.md)

Этот проект предоставляет библиотеку Python и инструмент командной строки (CLI) для взаимодействия с функцией OCR Google Lens через API, используемый в Chromium. Это позволяет обрабатывать изображения и извлекать текстовые данные, включая полный текст, координаты и сшитый текст, используя различные методы.

## Возможности

- **Извлечение полного текста**: Извлечение всего текста из изображения.
- **Извлечение координат**: Извлечение текста вместе с его координатами.
- **Сшивание текста**: Восстановление текста из блоков, используя различные методы:
  - **Полный текст по умолчанию**: Базовый метод сшивания блоков текста.
  - **Старый метод**: Последовательное сшивание текста.
  - **Новый метод**: Улучшенный метод сшивания текста.

PS. У Lens проблема с тем как он выдает полный текст, из-за чего были добавлены методы которые сшивают текст из координат.

## Установка

Вы можете установить пакет, используя `pip`:

### Из PyPI

```bash
pip install chrome-lens-py
```

### Из GIT

```bash
pip install git+https://github.com/bropines/chrome-lens-py.git
```

### Из исходников

Клонируйте репозиторий и установите пакет:

```bash
git clone https://github.com/bropines/chrome-lens-api-py.git
cd chrome-lens-api-py
pip install -r requirements.txt
pip install .
```

## Использование

Вы можете использовать команду `lens_scan` из командной строки для обработки изображений и извлечения текстовых данных или использовать программное API, чтобы интегрировать эту функциональность в свои проекты.

### Использование CLI

```bash
lens_scan <image_file> <data_type>
```

#### Типы данных

- **all**: Получить все данные (полный текст, координаты и сшитый текст, используя оба метода).
- **full_text_default**: Получить только полный текст по умолчанию.
- **full_text_old_method**: Получить сшитый текст, используя старый последовательный метод.
- **full_text_new_method**: Получить сшитый текст, используя новый улучшенный метод.
- **coordinates**: Получить текст вместе с координатами.

#### Пример

Для извлечения текста с использованием нового метода сшивания:

```bash
lens_scan <path/to/image.jpg> full_text_new_method
```

Для получения всех доступных данных:

```bash
lens_scan <path/to/image.jpg> all
```

#### Помощь по CLI

Вы можете использовать опцию `-h` или `--help`, чтобы отобразить информацию о использовании:

```bash
lens_scan -h
```

### Использование программного API

Кроме инструмента CLI, этот проект предоставляет Python API, который можно использовать в ваших скриптах.

#### Основное использование API

Сначала импортируйте класс `LensAPI`:

```python
from chrome_lens_py import LensAPI
```

#### Пример использования API

1. **Создайте экземпляр API**:

    ```python
    api = LensAPI()
    ```

2. **Обработайте изображение**:

    - **Получить все данные**:
  
        ```python
        result = api.get_all_data('path/to/image.jpg')
        print(result)
        ```

    - **Получить полный текст по умолчанию**:
  
        ```python
        result = api.get_full_text('path/to/image.jpg')
        print(result)
        ```

    - **Получить сшитый текст с использованием старого метода**:
  
        ```python
        result = api.get_stitched_text_sequential('path/to/image.jpg')
        print(result)
        ```

    - **Получить сшитый текст с использованием нового метода**:
  
        ```python
        result = api.get_stitched_text_smart('path/to/image.jpg')
        print(result)
        ```

    - **Получить текст с координатами**:
  
        ```python
        result = api.get_text_with_coordinates('path/to/image.jpg')
        print(result)
        ```

#### Методы программного API

- **`get_all_data(image_path)`**: Возвращает все доступные данные для данного изображения.
- **`get_full_text(image_path)`**: Возвращает только полный текст из изображения.
- **`get_text_with_coordinates(image_path)`**: Возвращает текст вместе с его координатами в формате JSON.
- **`get_stitched_text_smart(image_path)`**: Возвращает сшитый текст, используя улучшенный метод.
- **`get_stitched_text_sequential(image_path)`**: Возвращает сшитый текст, используя базовый последовательный метод.

#### Работа с координатами

В нашем проекте координаты используются для определения позиции, размера и поворота текста на изображении. Каждая текстовая область описывается набором значений, которые помогают точно определить, где и как отобразить текст. Вот как интерпретируются эти значения:

1. **Координата Y**: Первое значение в массиве координат определяет вертикальную позицию верхнего левого угла текстовой области на изображении. Значение выражается в виде доли от общей высоты изображения, то есть `0.0` соответствует верхнему краю, а `1.0` — нижнему.

2. **Координата X**: Второе значение указывает горизонтальную позицию верхнего левого угла текстовой области. Значение выражается в виде доли от общей ширины изображения, где `0.0` соответствует левому краю, а `1.0` — правому.

3. **Ширина**: Третье значение обозначает ширину текстовой области как долю от общей ширины изображения. Это значение позволяет определить, сколько пространства по горизонтали займет текст.

4. **Высота**: Четвертое значение указывает высоту текстовой области как долю от общей высоты изображения.

5. **Пятый параметр**: В текущих данных этот параметр всегда равен нулю и, видимо, не используется. Возможно, он зарезервирован для будущего использования или определенных модификаций текста.

6. **Шестой параметр**: Указывает угол поворота текстовой области в градусах. Положительные значения означают поворот по часовой стрелке, а отрицательные — против часовой стрелки.

Координаты отсчитываются от верхнего левого угла изображения. Это означает, что `(0.0, 0.0)` будет соответствовать самой верхней левой точке изображения, а `(1.0, 1.0)` — самой нижней правой точке.

#### Пример использования координат

Для наглядности рассмотрим следующий пример координат:

```json
{
    "text": "Пример текста",
    "coordinates": [
        0.5,
        0.5,
        0.3,
        0.1,
        0,
        -45
    ]
}
```

В этом примере:
- `0.5` — Y-координата (50% от высоты изображения, текст по центру по вертикали).
- `0.5` — X-координата (50% от ширины изображения, текст по центру по горизонтали).
- `0.3` — ширина текстовой области (30% от ширины изображения).
- `0.1` — высота текстовой области (10% от высоты изображения).
- `0` — не используется, значение по умолчанию. (наверное, я не нашел пока изображений где оно отличается от нуля).
- `-45` — угол поворота текста против часовой стрелки на 45 градусов.

Эти значения используются для правильного размещения, масштабирования и отображения текста на изображении.

## Структура проекта

```
/chrome-lens-api-py
│
├── /src
│   ├── /chrome_lens_py
│   │   ├── __init__.py           # Инициализация пакета
│   │   ├── constants.py          # Константы, используемые в проекте
│   │   ├── utils.py              # Утилиты
│   │   ├── image_processing.py   # Модуль обработки изображений
│   │   ├── request_handler.py    # Модуль для работы с запросами и API
│   │   ├── text_processing.py    # Модуль обработки текста
│   │   ├── lens_api.py           # Интерфейс API для использования в других скриптах
│   │   └── main.py               # Точка входа для CLI-инструмента
│
├── setup.py                      # Настройки установки
├── README.md                     # Описание проекта и руководство пользователя
└── requirements.txt              # Зависимости проекта
```

## Благодарности

Особая благодарность [dimdenGD](https://github.com/dimdenGD) за метод извлечения текста, использованный в этом проекте. Вы можете ознакомиться с их работой в репозитории [chrome-lens-ocr](https://github.com/dimdenGD/chrome-lens-ocr). Этот проект вдохновлен их подходом к использованию OCR Google Lens.

## TODO
- Перенести все методы из [chrome-lens-ocr](https://github.com/dimdenGD/chrome-lens-ocr)
- Сделать все красиво, а не как 400 строк кода, попиленых чатом гпт на модули
- Еще что-то очень, очень важное...

## Лицензия

Этот проект лицензирован на условиях лицензии MIT. Подробнее см. файл [LICENSE](LICENSE).

## Отказ от ответственности

Этот проект предназначен исключительно для образовательных целей. Использование функционала OCR Google Lens должно соответствовать условиям предоставления услуг Google. Автор данного проекта не несет ответственности за неправомерное использование данного программного обеспечения или за любые последствия, возникающие в результате его использования. Пользователи несут полную ответственность за то, чтобы их использование данного программного обеспечения соответствовало всем применимым законам и нормативным актам.

## Автор

### Bropines  - [Почта](mailto:bropines@gmail.com) / [Telegram](https://t.me/bropines)
