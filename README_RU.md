# Chrome Lens API для Python

[English](/README.md) | [Русский](/README_RU.md)

Этот проект предоставляет библиотеку Python и CLI инструмент для взаимодействия с функциональностью OCR Google Lens через API, используемое в Chromium. Это позволяет обрабатывать изображения и извлекать текстовые данные, включая полный текст, координаты и сшитый текст, используя различные методы.

## Возможности

- **Извлечение полного текста**: Извлекайте полный текст с изображения.
- **Извлечение координат**: Извлекайте текст вместе с его координатами.
- **Сшитый текст**: Восстанавливайте текст из блоков координат, используя различные методы:
  - **Старый метод**: Последовательное сшивание текста.
  - **Новый метод**: Улучшенное сшивание текста за счет расчета их по строчкам. Не рекомендуется на повернутых текстах. Используйте прошлый.
- **Управление куки**: Загружайте и управляйте куками из файла в формате Netscape или напрямую через конфигурацию.
- **Поддержка прокси**: Поддержка HTTP, HTTPS и SOCKS4/5 прокси для выполнения запросов через разные сети.

PS. У Google Lens есть проблема с отображением полного текста, поэтому добавлены методы, которые сшивают текст из координат.

## Установка

Вы можете установить пакет, используя `pip`:

### Из PyPI

```bash
pip install chrome-lens-py
```

### Из GIT

```bash
pip install git+https://github.com/bropines/chrome-lens-py.git
```

### Из исходников

Клонируйте репозиторий и установите пакет:

```bash
git clone https://github.com/bropines/chrome-lens-api-py.git
cd chrome-lens-api-py
pip install -r requirements.txt
pip install .
```

## Использование

Вы можете использовать команду `lens_scan` в CLI для обработки изображений и извлечения текстовых данных, или вы можете использовать Python API для интеграции этой функциональности в ваши собственные проекты.

<details>
  <summary><b>Использование CLI</b></summary>

```bash
lens_scan <image_file> <data_type>
```

#### Типы данных

- **all**: Получить все данные (полный текст, координаты и сшитый текст с использованием обоих методов).
- **full_text_default**: Получить только полный текст по умолчанию.
- **full_text_old_method**: Получить сшитый текст с использованием старого последовательного метода.
- **full_text_new_method**: Получить сшитый текст с использованием нового улучшенного метода.
- **coordinates**: Получить текст вместе с координатами.

#### Пример 

Чтобы извлечь текст с использованием нового метода сшивания:

```bash
lens_scan path/to/image.jpg full_text_new_method
```

Чтобы получить все доступные данные:

```bash
lens_scan path/to/image.jpg all
```

#### CLI Справка

Вы можете использовать опцию `-h` или `--help`, чтобы вывести справочную информацию:

```bash
lens_scan -h
```

</details>

<details>
  <summary><b>Использование API</b></summary>

#### Базовое использование API

Сначала импортируйте класс `LensAPI`:

```python
from chrome_lens_py import LensAPI
```

#### Пример использования API

1. **Создание экземпляра API**:

    ```python
    api = LensAPI()
    ```

2. **Обработка изображения**:

    - **Получение всех данных**:
  
        ```python
        result = api.get_all_data('path/to/image.jpg')
        print(result)
        ```

    - **Получение полного текста**:
  
        ```python
        result = api.get_full_text('path/to/image.jpg')
        print(result)
        ```

    - **Получение сшитого текста с использованием старого метода**:
  
        ```python
        result = api.get_stitched_text_sequential('path/to/image.jpg')
        print(result)
        ```

    - **Получение сшитого текста с использованием нового метода**:
  
        ```python
        result = api.get_stitched_text_smart('path/to/image.jpg')
        print(result)
        ```

    - **Получение текста с координатами**:
  
        ```python
        result = api.get_text_with_coordinates('path/to/image.jpg')
        print(result)
        ```

</details>

<details>
  <summary><b>Управление куки</b></summary>

#### Этот проект поддерживает управление куками через различные методы:

1. **Загрузка куки из файла в формате Netscape**:
    
    * Вы можете загрузить куки из файла в формате Netscape, указав путь к файлу.
    
    **Программный API**:
    
    ```python
    config = {
        'headers': {
            'cookie': '/path/to/cookie_file.txt'
        }
    }
    api = LensAPI(config=config)
    ```
    
    **CLI**:
    
    ```bash
    lens_scan path/to/image.jpg all -c /path/to/cookie_file.txt
    ```
    
2. **Передача куки напрямую в виде строки**:
    
    * Вы также можете передавать куки напрямую в виде строки через конфигурацию или CLI.
    
    **Программный API**:
    
    ```python
    config = {
        'headers': {
            'cookie': '__Secure-ENID=17.SE=-dizH-; NID=511=---bcDwC4fo0--lgfi0n2-'
        }
    }
    api = LensAPI(config=config)
    ```
    или
   
    ```python
    config = 
       'headers': {
        'cookie': {
            '__Secure-ENID': {
                'name': '__Secure-ENID',
                'value': '',
                'expires': 1756858205,
            },
            'NID': {
                'name': 'NID',
                'value': '517=4.......',
                'expires': 1756858205,
            }
        }
    }
    api = LensAPI(config=config)
    ```

</details>

<details>
  <summary><b>Поддержка прокси</b></summary>

#### Вы можете выполнять запросы через прокси-сервер, используя API или CLI. Библиотека поддерживает HTTP, HTTPS и SOCKS4/5 прокси.

* **Установка прокси в API**:
    
    ```python
    config = {
        'proxy': 'socks5://127.0.0.1:2080'
    }
    api = LensAPI(config=config)
    ```
    
* **Установка прокси в CLI**:
    
    ```bash
    lens_scan path/to/image.jpg all -p socks5://127.0.0.1:2080
    ```

</details>

<details>
  <summary><b>Методы программного API</b></summary>

- **`get_all_data(image_path)`**: Возвращает все доступные данные для данного изображения.
- **`get_full_text(image_path)`**: Возвращает только полный текст с изображения.
- **`get_text_with_coordinates(image_path)`**: Возвращает текст вместе с его координатами в формате JSON.
- **`get_stitched_text_smart(image_path)`**: Возвращает сшитый текст с использованием улучшенного метода.
- **`get_stitched_text_sequential(image_path)`**: Возвращает сшитый текст с использованием базового последовательного метода.

</details>

<details>
  <summary><b>Работа с координатами</b></summary>

В нашем проекте координаты используются для определения позиции, размера и угла поворота текста на изображении. Каждая текстовая область описывается набором значений, которые помогают точно определить, где и как отображать текст. Вот как эти значения интерпретируются:

1. **Y-координата**: Первое значение в массиве координат представляет вертикальное положение верхнего левого угла текстовой области на изображении. Значение выражается в долях от общей высоты изображения, где `0.0` соответствует верхнему краю, а `1.0` - нижнему.

2. **X-координата**: Второе значение указывает горизонтальное положение верхнего левого угла текстовой области. Значение выражается в долях от общей ширины изображения, где `0.0` соответствует левому краю, а `1.0` - правому.

3. **Ширина**: Третье значение представляет ширину текстовой области в долях от общей ширины изображения. Это значение определяет, сколько горизонтального пространства будет занимать текст.

4. **Высота**: Четвертое значение указывает высоту текстовой области в долях от общей высоты изображения.

5. **Пятый параметр**: В текущих данных этот параметр всегда равен нулю и, по-видимому, не используется. Он может быть зарезервирован для будущего использования или для определенных модификаций текста.

6. **Шестой параметр**: Указывает угол поворота текстовой области в градусах. Положительные значения означают поворот по часовой стрелке, а отрицательные - против час
овой стрелки.

Координаты измеряются от верхнего левого угла изображения. Это означает, что `(0.0, 0.0)` соответствует самому верхнему левому углу изображения, а `(1.0, 1.0)` соответствует самому нижнему правому углу.

#### Пример использования координат

Для наглядности рассмотрим следующий пример координат:

```json
{
    "text": "Пример текста",
    "coordinates": [
        0.5,
        0.5,
        0.3,
        0.1,
        0,
        -45
    ]
}
```

В этом примере:
- `0.5` — Y-координата (50% высоты изображения, текст выровнен по вертикали по центру).
- `0.5` — X-координата (50% ширины изображения, текст выровнен по горизонтали по центру).
- `0.3` — ширина текстовой области (30% от ширины изображения).
- `0.1` — высота текстовой области (10% от высоты изображения).
- `0` — не используется, значение по умолчанию (возможно зарезервировано для будущего использования).
- `-45` — угол поворота текста против часовой стрелки на 45 градусов.

Эти значения используются для точного размещения, масштабирования и отображения текста на изображении.

</details>

## Структура проекта

```plain text
/chrome-lens-api-py
│
├── /src
│   ├── /chrome_lens_py
│   │   ├── __init__.py           # Инициализация пакета
│   │   ├── constants.py          # Константы, используемые в проекте
│   │   ├── utils.py              # Вспомогательные функции
│   │   ├── image_processing.py   # Модуль обработки изображений
│   │   ├── request_handler.py    # Модуль обработки запросов API
│   │   ├── text_processing.py    # Модуль обработки текста
│   │   ├── lens_api.py           # Интерфейс API для использования в других скриптах
│   │   └── main.py               # Точка входа CLI инструмента
│
├── setup.py                      # Установка проекта
├── README.md                     # Описание проекта и руководство по использованию
└── requirements.txt              # Зависимости проекта
```

## Благодарности

Особая благодарность [dimdenGD](https://github.com/dimdenGD) за метод извлечения текста, использованный в этом проекте. Вы можете ознакомиться с его работой в репозитории [chrome-lens-ocr](https://github.com/dimdenGD/chrome-lens-ocr). Этот проект вдохновлен их подходом к использованию функциональности OCR Google Lens.

## TODO
- Перенести все методы из [chrome-lens-ocr](https://github.com/dimdenGD/chrome-lens-ocr)
- Сделать все красиво, а не как 400 строк кода, разрезанных на модули через чат GPT
- Что-то еще очень, очень важное...

## Лицензия

Этот проект лицензирован на условиях лицензии MIT. Подробнее см. в файле [LICENSE](LICENSE).

## Отказ от ответственности

Этот проект предназначен только для образовательных целей. Использование функциональности OCR Google Lens должно соответствовать условиям использования Google. Автор этого проекта не несет ответственности за любое неправильное использование этого программного обеспечения или за любые последствия, возникающие из его использования. Пользователи несут полную ответственность за обеспечение того, что использование этого программного обеспечения соответствует всем применимым законам и нормативным актам.

## Автор

### Bropines  - [Почта](mailto:bropines@gmail.com) / [Telegram](https://t.me/bropines)

Спешал фор руско говорящих. Да ридми был написан ГПТшкой. Мне было ооооооочень лень его писать ручками)
